<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="CHOIR">
<title>Running CHOIR on atlas-scale data • CHOIR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Running CHOIR on atlas-scale data">
<meta property="og:description" content="CHOIR">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">CHOIR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/CHOIR.html">
    <span class="fa fa-graduation-cap"></span>
     
    Quick Tutorial
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">
    <span class="fa fa-code"></span>
     
    Functions
  </a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/corceslab/CHOIR">
    <span class="fa fa-github"></span>
     
    CHOIR on GitHub
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Running CHOIR on atlas-scale data</h1>
            
      
      
      <div class="d-none name"><code>atlas_scale_data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette provides a basic example of how to run CHOIR on
atlas-scale data.</p>
<p>Using CHOIR “straight out of the box” works best on datasets with
under 500,000 cells. While some larger datasets up to 1 million cells
may also run smoothly, other datasets of this size or larger may
encounter computational limits. In general, our assumption as developers
is that end-users who are attempting to analyze datasets larger than
500,000 cells have access to high-performance computational resources
that enable parallelization. At this scale of dataset, annotation of
cell groups can often take weeks of manual effort without the assistance
of a tool like CHOIR. While CHOIR will likely require at least 24 hours
to run on a dataset of 500,000 cells, it will store all of the
information an end-user would need to both annotate clusters and check
the decisions made by CHOIR. Specifically, for each cluster, including
those that were merged along the way, CHOIR stores the features found to
be most important for the cluster (e.g., marker genes) and the reasoning
behind why CHOIR merged or did not merge that cluster. These records can
be found in CHOIR→records→feature_importance_records and
CHOIR→records→comparison_records.</p>
<p>To use CHOIR on atlas-scale data, we recommend a three-step approach
that partitions the dataset into smaller relevant chunks (step 1), runs
CHOIR in parallel on those smaller chunks (step 2), and then stitches
the results back together to provide a final set of clusters (step 3). A
detailed tutorial for how to accomplish this is available on the CHOIR
website (<a href="https://www.CHOIRclustering.com" class="external-link uri">https://www.CHOIRclustering.com</a>) and we encourage users
to reference that documentation, as it will be maintained over time.</p>
</div>
<div class="section level2">
<h2 id="step-1-generate-parent-clusters">Step 1: Generate parent clusters<a class="anchor" aria-label="anchor" href="#step-1-generate-parent-clusters"></a>
</h2>
<p>On the full dataset, run the CHOIR function buildParentTree. This
function runs the initial dimensionality reduction, optional batch
correction, and subsequent steps to generate the “parent” clustering
tree. This clustering tree extends from a single cluster encompassing
all cells to the cluster level at which the silhouette score is
maximized. If any of these resulting “parent clusters” are above 450,000
cells, a minimal number of further subdivisions are run on that parent
cluster until the resulting subclusters are all under 450,000 cells.</p>
</div>
<div class="section level2">
<h2 id="step-2-run-choir-on-each-subsetted-parent-cluster">Step 2: Run CHOIR on each subsetted parent cluster<a class="anchor" aria-label="anchor" href="#step-2-run-choir-on-each-subsetted-parent-cluster"></a>
</h2>
<p>Subset each parent cluster and save it as a separate object. Run the
standard CHOIR method on each of these objects. Extract the final
clusters, clustering trees, and comparison records from each object
using the CHOIR function getRecords.</p>
</div>
<div class="section level2">
<h2 id="step-3-combine-subtrees-and-standardize-significance-thresholds">Step 3: Combine subtrees and standardize significance
thresholds<a class="anchor" aria-label="anchor" href="#step-3-combine-subtrees-and-standardize-significance-thresholds"></a>
</h2>
<p>Run the CHOIR function combineTrees on the complete set of records
extracted in step 2. In doing so, the significance threshold will be
standardized across all clustering trees, yielding a final set of
clusters.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Cathrine Sant.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
